import{d as e,o as l,c as a,l as t,w as o,$ as s,F as i,A as n,H as d,D as r,u as m,a0 as c,h as u,a as p,E as v,ab as g,ac as y,s as I,k as b,B as _,J as f,V as h,R as C,ae as k,a1 as w,Q as z,af as D,Z as V,ag as x,ah as R,n as B,ai as L,T as N,aj as j,U,ak as A}from"./vendor-178c6cbf.js";import{_ as F}from"./zb-image-666aee3b.js";import{_ as O,u as M,i as E,v as P,a as S,e as T,b as q,r as Z}from"./index-72685b17.js";import{t as H}from"./tag-2dd95940.js";import{z as J}from"./zb-empty-147831cd.js";import{_ as Q}from"./zb-time-3ead2a7c.js";import{z as $}from"./zb-loading-f402cb15.js";import{u as G}from"./useInfiniteScroll-c83ba412.js";import{z as K}from"./zb-loadMore-81cb5e35.js";import{Z as W}from"./zb-card-9556c3d7.js";import"./dayFormat-c374a561.js";const X={class:"blogInfo-container"},Y={class:"top"},ee={class:"title"},le={class:"createdAt"},ae={class:"bottom"},te={class:"author"},oe={class:"data"},se={class:"data-item"},ie={class:"text"},ne={class:"data-item"},de={class:"text"},re={class:"data-item"},me={class:"text"},ce=O(e({__name:"blogInfo",props:{blogDeatil:{}},setup:e=>(e,s)=>(l(),a("div",X,[t("div",Y,[t("div",ee,o(e.blogDeatil.title),1),t("div",le,o(e.blogDeatil.createdAt)+" 发布",1)]),t("div",ae,[t("div",te,"作者："+o(e.blogDeatil.author),1),t("div",oe,[t("div",se,[t("span",ie,"阅读："+o(e.blogDeatil.blog_read),1)]),t("div",ne,[t("span",de,"点赞："+o(e.blogDeatil.blog_like),1)]),t("div",re,[t("span",me," 收藏："+o(e.blogDeatil.blog_collect),1)])])])]))}),[["__scopeId","data-v-73185114"]]),ue={class:"blogFooter-container"},pe={class:"tag-list"},ve=O(e({__name:"blogFooter",props:{blogDeatil:{}},setup:e=>(e,u)=>{const p=c;return l(),a("div",ue,[s(" 标签： "),t("div",pe,[(l(!0),a(i,null,n(e.blogDeatil.tags,((e,a)=>(l(),d(p,{color:m(H)[Number(e.tag_classify)].color,key:e.id},{default:r((()=>[s(o(e.tag_name),1)])),_:2},1032,["color"])))),128))])])}}),[["__scopeId","data-v-b4cfea07"]]),ge={class:"commentPost-container",ref:"commentRef"},ye={class:"text-input"},Ie={class:"avatar"},be=["src"],_e={class:"input"},fe={class:"comfirm"},he=O(e({__name:"commentPost",props:{blogId:{},userImage:{}},emits:["refreshComment"],setup(e,{emit:o}){const i=e,n=o,d=u(""),{blog:c}=M(),I=async()=>{if(P(d.value))return v.warning("不能为空");const e={blog_id:i.blogId,content:d.value};await c.addComment(e),v.success("发布评论成功"),d.value="",n("refreshComment",!0)};return(e,o)=>{const i=g,n=y;return l(),a("div",ge,[t("div",ye,[t("div",Ie,[t("img",{src:m(E)(e.userImage),alt:""},null,8,be)]),t("div",_e,[p(i,{rows:4,modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=e=>d.value=e),maxlength:"255",placeholder:"平等表达，友善交流","show-word-limit":"",type:"textarea"},null,8,["modelValue"])])]),t("div",fe,[p(n,{onClick:I,type:"primary"},{default:r((()=>[s("发布")])),_:1})])],512)}}}),[["__scopeId","data-v-8632b4d0"]]),Ce={class:"replyArea"},ke={class:"input"},we={class:"reply"},ze=O(e({__name:"commentItemReplyPost",props:{modelValue:{type:Boolean},replyId:{},replyChildId:{}},emits:["update:modelValue"],setup(e,{emit:o}){const i=o,n=u(""),{blog:d}=M(),{blogDeatil:m}=I(d);return(e,o)=>{const c=g,u=y;return l(),a("div",Ce,[t("div",ke,[p(c,{rows:3,modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=e=>n.value=e),maxlength:"255",placeholder:"请输入~","show-word-limit":"",type:"textarea"},null,8,["modelValue"])]),t("div",we,[p(u,{type:"primary",onClick:o[1]||(o[1]=l=>(async(e,l)=>{if(P(n.value))return v.warning("不能为空");const a={blog_id:m.value.id,content:n.value,parent_id:e};l&&(a.reply_to=l),await d.addComment(a),v.success("发布评论成功"),n.value="",i("update:modelValue",!1)})(e.replyId,e.replyChildId))},{default:r((()=>[s("发布")])),_:1})])])}}}),[["__scopeId","data-v-00ae8fc1"]]),De={class:"bottom"},Ve=O(e({__name:"commentItemReplyBottomOperator",props:{data:{},replyId:{},replyChildId:{}},setup(e){const s=e,{blog:n}=M(),{userCommentDianzanList:d}=I(n),r=u(!1),m=u(s.data.dianzanCount),c=s.replyChildId?s.replyChildId:s.replyId,g=b((()=>d.value.includes(s.data.id))),y=async()=>{g.value?(async()=>{await n.cancelDianzanComment(s.replyChildId?s.replyChildId:s.replyId)&&(m.value--,d.value=d.value.filter((e=>e!==c)))})():(async()=>{await n.dianzanComment(c)&&(v.success("点赞成功"),m.value++,d.value.push(c))})()};return(e,s)=>{const n=Q,d=S;return l(),a(i,null,[t("div",De,[p(n,{time:e.data.createdAt,type:"fromNow"},null,8,["time"]),t("span",{class:_({operatorItem:!0,active:g.value}),onClick:y},[p(d,{name:"like",size:17,color:g.value?"var(--theme-active-color)":"var(--theme-text-2)"},null,8,["color"]),t("span",null,o(0===m.value?"点赞":m.value),1)],2),t("span",{class:_({operatorItem:!0,active:r.value}),onClick:s[0]||(s[0]=()=>{r.value=!r.value})},[p(d,{name:"pinglun",size:17,color:r.value?"var(--theme-active-color)":"var(--theme-text-2)"},null,8,["color"]),t("span",null,o(r.value?"取消回复":"回复"),1)],2)]),f(p(ze,{modelValue:r.value,"onUpdate:modelValue":s[1]||(s[1]=e=>r.value=e),replyId:e.replyId,replyChildId:e.replyChildId},null,8,["modelValue","replyId","replyChildId"]),[[h,r.value]])],64)}}}),[["__scopeId","data-v-647ea2e2"]]),xe={class:"comment-container"},Re={class:"avatar"},Be=["src"],Le={class:"box"},Ne={class:"info"},je={key:0,class:"comment"},Ue={class:"name"},Ae={class:"content"},Fe={key:1,class:"reply"},Oe={class:"name"},Me={key:0,class:"name-reply"},Ee={class:"name"},Pe={key:2,class:"replied-content"},Se=O(e({__name:"commentItemReply",props:{commentInfo:{},replyId:{},replyChildId:{},type:{}},setup:e=>(e,i)=>{var n,d;return l(),a("div",xe,[t("div",Re,[t("img",{src:m(E)(e.commentInfo.user.user_image),alt:""},null,8,Be)]),t("div",Le,[t("div",Ne,["comment"===e.type?(l(),a("div",je,[t("span",Ue,o(e.commentInfo.user.name),1),t("div",Ae,o(e.commentInfo.content),1)])):(l(),a("div",Fe,[t("span",Oe,o(e.commentInfo.user.name),1),e.commentInfo.targetComment?(l(),a("span",Me,[s(o(" 回复 ")+" "),t("span",Ee,o(e.commentInfo.targetComment?null==(n=e.commentInfo.targetComment)?void 0:n.user.name:""),1)])):C("",!0),s(" ："+o(e.commentInfo.content),1)])),e.commentInfo.targetComment?(l(),a("div",Pe,o(null==(d=e.commentInfo.targetComment)?void 0:d.content),1)):C("",!0),p(Ve,{data:e.commentInfo,replyId:e.replyId,replyChildId:e.replyChildId},null,8,["data","replyId","replyChildId"])])])])}}),[["__scopeId","data-v-e878eb92"]]),Te=O(e({__name:"commentItemAllReplayOperator",props:{id:{}},emits:["closeAllReply"],setup(e,{emit:o}){const{blog:s}=M(),n=e,d=o,r=u(!1),m=async()=>{r.value=!0,await s.getChildrenComment(n.id,1,999),r.value=!1,d("closeAllReply")};return(e,o)=>(l(),a(i,null,[f(t("div",{class:"allReply",onClick:m}," 查看全部回复 ",512),[[h,!r.value]]),f(p($,{height:50},null,512),[[h,r.value]])],64))}}),[["__scopeId","data-v-d59982e3"]]),qe={class:"commentItem-container"},Ze={key:0,class:"child-reply"},He=O(e({__name:"commentItem",props:{item:{}},setup(e){const t=u(3===e.item.children.length),o=()=>{t.value=!1};return(e,s)=>(l(),a("div",qe,[p(Se,{type:"comment",replyId:e.item.id,commentInfo:e.item},null,8,["replyId","commentInfo"]),e.item.children.length>0?(l(),a("div",Ze,[(l(!0),a(i,null,n(e.item.children,(a=>(l(),d(Se,{key:a.id,type:"reply",replyId:e.item.id,replyChildId:a.id,commentInfo:a},null,8,["replyId","replyChildId","commentInfo"])))),128)),t.value?(l(),d(Te,{key:0,id:e.item.id,onCloseAllReply:o},null,8,["id"])):C("",!0)])):C("",!0)]))}}),[["__scopeId","data-v-cfe43ca8"]]),Je={class:"commentList-container"},Qe={class:"title"},$e=["infinite-scroll-disabled"],Ge=O(e({__name:"commentList",setup(e){const{blog:c}=M(),{blogDeatil:u,commentList:v,commentTotal:g,commentCount:_}=I(c);c.getUserDianzanIdList();const{loadMore:h,isLoading:C}=G((async e=>await c.getComment(u.value.id,e,9))),z=b((()=>_.value>v.value.length));return(e,c)=>{const u=y,I=J,b=w;return l(),a("div",Je,[t("div",Qe,[s(" 全部评论 "+o(0===m(g)?"":m(g))+" ",1),p(u,{"loading-icon":m(k),loading:m(C),onClick:c[0]||(c[0]=e=>m(h)(!0))},{default:r((()=>[s(" 刷新 ")])),_:1},8,["loading-icon","loading"])]),f((l(),a("div",{class:"comment-list","infinite-scroll-disabled":!z.value,"infinite-scroll-delay":500},[(l(!0),a(i,null,n(m(v),(e=>(l(),d(He,{item:e,key:e.id},null,8,["item"])))),128))],8,$e)),[[b,m(h)]]),0!==m(v).length?(l(),d(K,{key:0,isLoading:m(C),direction:"center",isLoadMore:z.value},null,8,["isLoading","isLoadMore"])):(l(),d(I,{key:1}))])}}}),[["__scopeId","data-v-6080631b"]]),Ke={class:"tool-container"},We={class:"tool-list"},Xe=["onClick"],Ye=O(e({__name:"blogOperator",props:{id:{}},emits:["toComment"],setup(e,{emit:o}){const s=e,d=u([{type:"like",text:"点赞",icon:"dianzan"},{type:"collect",text:"收藏",icon:"shoucang"}]),r=T(),{blogStatus:c}=I(r),g=async()=>{if(c.value.like)await r.blogUnlike();else{await r.blogLike()&&v.success("感谢支持！")}r.getBlogDetail(Number(s.id))},y=async()=>{if(c.value.collect)await r.blogUncollect();else{await r.blogCollect()&&v.success("感谢支持！")}await r.getBlogDetail(Number(s.id))};return(e,o)=>{const s=S;return l(),a("div",Ke,[t("div",We,[(l(!0),a(i,null,n(d.value,((e,t)=>(l(),a("div",{class:_({"tool-item":!0,active:m(c)[e.type]}),key:t,onClick:l=>(e=>{switch(e){case"like":g();break;case"collect":y()}})(e.type)},[p(s,{name:e.icon,size:"25",color:m(c)[e.type]?"var(--theme-active-show)":""},null,8,["name","color"])],10,Xe)))),128))])])}}}),[["__scopeId","data-v-7f64c7cf"]]),el={class:"blog-container"},ll={class:"blog-card"},al={class:"blog-detail-card"},tl={class:"mainImg"},ol={class:"blog-detail-card"},sl=O(e({__name:"index",setup(e){const{common:o,blog:s,user:n}=M(),{isDark:d,rightOpen:c,commentOpen:v,isMobile:g}=I(o),{blogDeatil:y,blogStatus:_}=I(s),{userInfo:f}=I(n),h=z(),C=u(""),k=h.query.id,w=b((()=>g.value?{size:"100%",direction:"btt"}:{size:"25%",direction:"rtl"})),O=b((()=>h.query.id)),E=document.documentElement,P=u("myPreview");D(O,(e=>{T(e)})),V((async()=>{if(q()&&(s.isBlogLike(Number(k)),s.isBlogCOllect(Number(k))),_.value.read||(s.addBlogRead(Number(k)),_.value.read=!0),await s.getBlogDetail(Number(k)),x((()=>{C.value=y.value.content_text})),S(),s.getRecommendBlogList(Number(k)),q()){const e=await n.isFollowUser(y.value.user.id);H.value=e}J.value=f.value.id===y.value.user.id,window.scrollTo({top:0})})),R((()=>{_.value.read=!1}));const S=async()=>{await s.getComment(y.value.id,1,9)},T=async e=>{if(e){if(q()&&(s.isBlogLike(Number(e)),s.isBlogCOllect(Number(e))),_.value.read||(s.addBlogRead(Number(e)),_.value.read=!0),await s.getBlogDetail(Number(e)),x((()=>{C.value=y.value.content_text})),S(),s.getRecommendBlogList(Number(e)),q()){const e=await n.isFollowUser(y.value.user.id);H.value=e}J.value=f.value.id===y.value.user.id,Z.push("/blog/detail?id="+e)}},H=u(!1),J=u(!1);return(e,o)=>{const s=F,n=j,u=U;return l(),a(i,null,[t("div",el,[t("div",ll,[t("div",al,[p(ce,{blogDeatil:m(y)},null,8,["blogDeatil"]),t("div",tl,[p(s,{src:m(y).blog_image,style:B({height:(m(g)?240:400)+"px"})},null,8,["src","style"])]),p(m(L),{editorId:P.value,modelValue:C.value,"onUpdate:modelValue":o[0]||(o[0]=e=>C.value=e),theme:m(d)?"dark":"light",showCodeRowNumber:!0},null,8,["editorId","modelValue","theme"]),p(n),p(ve,{blogDeatil:m(y)},null,8,["blogDeatil"])]),t("div",ol,[p(he,{blogId:m(y).id,userImage:m(f).user_image,onRefreshComment:S},null,8,["blogId","userImage"]),p(Ge)])])]),p(u,{modelValue:m(c),"onUpdate:modelValue":o[1]||(o[1]=e=>N(c)?c.value=e:null),size:w.value.size,direction:w.value.direction,"lock-scroll":!1},{default:r((()=>[p(W,{title:"操作"},{default:r((()=>[p(Ye,{id:m(k)},null,8,["id"])])),_:1}),p(W,{title:"目录"},{default:r((()=>[p(m(A),{editorId:P.value,scrollElement:m(E)},null,8,["editorId","scrollElement"])])),_:1})])),_:1},8,["modelValue","size","direction"]),p(u,{modelValue:m(v),"onUpdate:modelValue":o[2]||(o[2]=e=>N(v)?v.value=e:null),title:"评论",size:w.value.size,"lock-scroll":!1,direction:w.value.direction},{default:r((()=>[p(he,{blogId:m(y).id,userImage:m(f).user_image,onRefreshComment:S},null,8,["blogId","userImage"]),p(Ge)])),_:1},8,["modelValue","size","direction"])],64)}}}),[["__scopeId","data-v-395703dd"]]);export{sl as default};
